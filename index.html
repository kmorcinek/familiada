<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Familiada</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <audio id="wrong-answer-sound" src="https://www.myinstants.com/media/sounds/wrong-answer-sound-effect.mp3"></audio>
    <audio id="correct-answer-sound" src="https://www.myinstants.com/media/sounds/correct-answer.mp3"></audio>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px;
            background-color: #f0f0f0;
            font-size: 27px; /* Base font size 1.5x */
        }
        .question {
            font-size: 48px; /* Question text 1.5x */
            margin: 30px 0;
            text-align: center;
            color: #e74c3c;
            font-weight: bold;
        }
        .answer-container {
            background: white;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .answer {
            font-size: 42px; /* Answer text 1.5x */
            color: #2980b9;
            visibility: hidden;
            display: flex;
            align-items: center;
        }
        .answer.visible {
            color: #27ae60;
        }
        .wrong-mark {
            color: red;
            font-size: 54px; /* X marks 1.5x */
            margin-left: 23px;
            display: inline-block;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            font-size: 63px; /* Heading 1.5x */
            margin-bottom: 45px;
        }
        .teams-layout {
            display: flex;
            justify-content: space-between;
            gap: 30px;
            margin-bottom: 45px;
        }
        .team-section {
            display: flex;
            gap: 15px;
            align-items: center;
            flex: 1;
            justify-content: center;
        }
        .team-input {
            padding: 15px;
            font-size: 36px; /* Team name input 1.5x */
            width: 50%;
            box-sizing: border-box;
        }
        .team-points {
            padding: 15px;
            font-size: 36px; /* Team points 1.5x */
            width: 30%;
            box-sizing: border-box;
            background-color: #e8e8e8;
            border: 2px solid #ccc;
            text-align: center;
            font-weight: bold;
        }
        .add-points-btn {
            padding: 12px 23px;
            font-size: 36px; /* Button text 1.5x */
            background-color: #27ae60;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        .add-points-btn:hover {
            background-color: #219a52;
        }
        .add-points-btn:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        .wrong-answer-section {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 30px;
        }
        #wrong-marks {
            display: flex;
            align-items: center;
        }
        .points {
            font-weight: bold;
            color: #27ae60;
            font-size: 39px; /* Points text 1.5x */
        }
        button {
            padding: 15px 30px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 33px; /* Button text 1.5x */
            margin: 8px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .hidden {
            display: none;
        }
        .visible {
            visibility: visible;
        }
        #title-container {
            text-align: center;
            margin-bottom: 30px;
        }
        #show-title-btn {
            margin: 15px;
        }
    </style>
</head>
<body>
    <h1>Familiada</h1>
    <div class="teams-layout">
        <div class="team1 team-section">
            <input type="text" class="team-input" value="Drużyna 1">
            <input type="text" class="team-points" id="team1-points" value="0" readonly>
            <button class="add-points-btn" id="team1-add">+</button>
        </div>
        <div class="team2 team-section">
            <input type="text" class="team-input" value="Drużyna 2">
            <input type="text" class="team-points" id="team2-points" value="0" readonly>
            <button class="add-points-btn" id="team2-add">+</button>
        </div>
    </div>
    <div id="game-container">
        <div class="question hidden"></div>
        <div id="answers" class="hidden"></div>
        <div class="wrong-answer-section hidden">
            <div id="wrong-marks"></div>
        </div>
    </div>

    <script>
        const allGameQuestions = [
            {
                "question": "Popularny owoc zaczynający się na literę 'J'",
                "answers": [
                    {"text": "Jabłko", "points": 45},
                    {"text": "Jagody", "points": 25},
                    {"text": "Jeżyny", "points": 15},
                    {"text": "Jarzębina", "points": 10},
                    {"text": "Jaszczur", "points": 5}
                ]
            },
            {
                "question": "Popularny sport zimowy",
                "answers": [
                    {"text": "Narciarstwo", "points": 35},
                    {"text": "Hokej", "points": 25},
                    {"text": "Łyżwiarstwo", "points": 20},
                    {"text": "Saneczkarstwo", "points": 15},
                    {"text": "Curling", "points": 5}
                ]
            },
            {
                "question": "Co najczęściej znajduje się w lodówce?",
                "answers": [
                    {"text": "Mleko", "points": 40},
                    {"text": "Ser", "points": 30},
                    {"text": "Masło", "points": 15},
                    {"text": "Jajka", "points": 10},
                    {"text": "Wędlina", "points": 5}
                ]
            },
            {
                "question": "Popularne zwierzę domowe",
                "answers": [
                    {"text": "Pies", "points": 40},
                    {"text": "Kot", "points": 35},
                    {"text": "Chomik", "points": 15},
                    {"text": "Papuga", "points": 5},
                    {"text": "Rybki", "points": 5}
                ]
            },
            {
                "question": "Co ludzie robią w weekend?",
                "answers": [
                    {"text": "Odpoczywają", "points": 35},
                    {"text": "Sprzątają", "points": 25},
                    {"text": "Oglądają TV", "points": 20},
                    {"text": "Spotykają się", "points": 15},
                    {"text": "Śpią", "points": 5}
                ]
            },
            {
                "question": "Popularne warzywo",
                "answers": [
                    {"text": "Marchewka", "points": 35},
                    {"text": "Ziemniak", "points": 30},
                    {"text": "Pomidor", "points": 20},
                    {"text": "Ogórek", "points": 10},
                    {"text": "Cebula", "points": 5}
                ]
            },
            {
                "question": "Co można znaleźć w parku?",
                "answers": [
                    {"text": "Ławka", "points": 35},
                    {"text": "Drzewa", "points": 30},
                    {"text": "Plac zabaw", "points": 20},
                    {"text": "Kwiaty", "points": 10},
                    {"text": "Ptaki", "points": 5}
                ]
            },
            {
                "question": "Popularne zawody",
                "answers": [
                    {"text": "Nauczyciel", "points": 35},
                    {"text": "Lekarz", "points": 30},
                    {"text": "Kierowca", "points": 20},
                    {"text": "Kucharz", "points": 10},
                    {"text": "Prawnik", "points": 5}
                ]
            },
            {
                "question": "Co można kupić w piekarni?",
                "answers": [
                    {"text": "Chleb", "points": 40},
                    {"text": "Bułki", "points": 30},
                    {"text": "Pączki", "points": 15},
                    {"text": "Rogale", "points": 10},
                    {"text": "Drożdżówki", "points": 5}
                ]
            },
            {
                "question": "Popularne kolory",
                "answers": [
                    {"text": "Czerwony", "points": 35},
                    {"text": "Niebieski", "points": 30},
                    {"text": "Zielony", "points": 20},
                    {"text": "Żółty", "points": 10},
                    {"text": "Czarny", "points": 5}
                ]
            }
        ];
        
        // Losowo wybierz 10 pytań
        const gameQuestions = [...allGameQuestions]
            .sort(() => Math.random() - 0.5)
            .slice(0, 10);
        let currentQuestionIndex = 0;
        let gameData = gameQuestions[currentQuestionIndex];

        let wrongAnswersCount = 0;
        
        let team1Points = 0;
        let team2Points = 0;

        function resetGameState() {
            wrongAnswersCount = 0;
            $('#wrong-marks').empty();
            $('#answers').empty();
            $('.question').addClass('hidden');
            $('#answers').addClass('hidden');
            $('.wrong-answer-section').addClass('hidden');
            $('#team1-add, #team2-add').prop('disabled', false);
            
            // Reset controller buttons
            channel.postMessage({
                type: 'resetWrongButton'
            });
        }

        function loadQuestion() {
            gameData = gameQuestions[currentQuestionIndex];
            $('.question').text(gameData.question);
            
            gameData.answers.forEach((answer, index) => {
                const answerHtml = `
                    <div class="answer-container">
                        <span class="answer" id="answer-${index}">
                            ${answer.text} <span class="points">(${answer.points} pkt)</span>
                        </span>
                    </div>
                `;
                $('#answers').append(answerHtml);
            });
        }

        function calculateVisiblePoints() {
            let points = 0;
            $('.answer.visible').each(function() {
                const index = $(this).attr('id').split('-')[1];
                points += gameData.answers[index].points;
            });
            return points;
        }

        // Inicjalizacja kanału komunikacji
        const channel = new BroadcastChannel('familiada');
        
        // Nasłuchuj na wiadomości z kontrolera
        channel.onmessage = (event) => {
            if (event.data.type === 'showQuestion') {
                showQuestion();
            } else if (event.data.type === 'showAnswer') {
                showAnswer(event.data.index);
            } else if (event.data.type === 'wrongAnswer') {
                handleWrongAnswer();
            } else if (event.data.type === 'nextQuestion') {
                nextQuestion();
            }
        };

        $(document).ready(function() {

            // Załaduj pierwsze pytanie
            loadQuestion();
            
            // Wyślij odpowiedzi do kontrolera
            channel.postMessage({
                type: 'loadAnswers',
                answers: gameData.answers
            });


            // Obsługa przycisków dodawania punktów
            $('#team1-add').click(function() {
                const pointsToAdd = calculateVisiblePoints();
                team1Points += pointsToAdd;
                $('#team1-points').val(team1Points);
                $(this).prop('disabled', true);
                $('#team2-add').prop('disabled', true);
                $('#next-question-btn').removeClass('hidden');
            });

            $('#team2-add').click(function() {
                const pointsToAdd = calculateVisiblePoints();
                team2Points += pointsToAdd;
                $('#team2-points').val(team2Points);
                $(this).prop('disabled', true);
                $('#team1-add').prop('disabled', true);
                $('#next-question-btn').removeClass('hidden');
            });

        });

        function showQuestion() {
            $('.question').removeClass('hidden');
            $('#answers').removeClass('hidden');
            $('.wrong-answer-section').removeClass('hidden');
        }
        
        function showAnswer(index) {
            $(`#answer-${index}`).addClass('visible');
            $(`#button-${index}`).hide();
            document.getElementById('correct-answer-sound').play();
            
            // Enable next question button in controller after showing an answer
            channel.postMessage({
                type: 'enableNextButton'
            });
        }
        
        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < gameQuestions.length) {
                resetGameState();
                loadQuestion();
                // Wyślij nowe odpowiedzi do kontrolera
                channel.postMessage({
                    type: 'loadAnswers',
                    answers: gameData.answers
                });
            } else {
                const winner = team1Points > team2Points ? 'Drużyna 1' : team1Points < team2Points ? 'Drużyna 2' : 'Remis';
                const winnerText = winner === 'Remis' ? 'Remis!' : `Zwycięzca: ${winner}!`;
                alert(`Koniec gry!\n${winnerText}\nDrużyna 1: ${team1Points} punktów\nDrużyna 2: ${team2Points} punktów`);
                
                // Disable next question button in controller
                channel.postMessage({
                    type: 'disableNextButton'
                });
            }
        }
        
        function handleWrongAnswer() {
            wrongAnswersCount++;
            
            // Odtwórz dźwięk złej odpowiedzi
            document.getElementById('wrong-answer-sound').play();
            
            // Dodaj X do sekcji złych odpowiedzi
            $('#wrong-marks').append('<span class="wrong-mark">✗</span>');
            
            // Po 3 błędnych odpowiedziach wyślij informację do kontrolera
            if (wrongAnswersCount >= 3) {
                channel.postMessage({
                    type: 'disableWrongButton'
                });
            }
        }
    </script>
</body>
</html>
